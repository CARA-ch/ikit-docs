{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Primary system integration with CARA","text":"<p>Note</p> <p>28.08.2025 ikit.cara.ch for emedo: This release  documents the integration with the emedo platform and the documentation is in progress,  IdP integration needs manual configuration see changelog</p> <p>This documentation describes how the Integration Kit can be used to test the integration of a primary system with the CARA integration system.</p> <p>CARA offers different services:</p> <ul> <li>EPR patient portal https://portal.test.emedo.ch</li> <li>EPR professional portal https://professional.test.emedo.ch/login</li> </ul> <p>To access the integration system you will need to sign a contract/CGUE with CARA and provide</p> <ul> <li>an OID concept for your organization,</li> <li>define a OID for the patient assigning authority (needs to be configured manually by emedo/ofac)</li> </ul> <p>in return you will get:</p> <ul> <li>an HCP test user for which you need an online authentication yourself (e.g. HIN ID) and connect that HCP test user   with your online authentication</li> <li>two test patients for you with patient access, public test patients are listed here</li> </ul> <p>This will allow you to start the integration of the primary system.</p> <p>The Integration Kit (short IKIT) provides the following functionality:</p> <ul> <li>Authenticate an User and obtain an IdP assertion or a TCU assertion</li> <li>Proxy and log IHE transactions without client certificates and with basic validation of request / response</li> </ul> <p> </p> Integration architecture <p>This allows a primary system to do a stepwise integration. The integration kit is only an add-on during development, testing and CANNOT BE used with a production environment.</p> <p>Danger</p> <p>Use only test data and no real patient data! IKIT is completely open  and every request / response to the integration system made is retrievable.</p>"},{"location":"#testing-the-tls-connection-with-cara-int","title":"Testing the TLS connection with CARA INT","text":"<p>There are two different TLS connections with CARA INT you can test: the Syslog connection (to send ATNA messages)  and the webservices connection (to send IHE requests).</p> <p>In these tests, you have to use your own certificate and private key. Note that they may be stored in the same .pem file.</p>"},{"location":"#syslog-connection","title":"Syslog connection","text":"<p>You can test the Syslog connection with <code>openssl</code>: <pre><code>openssl s_client -connect adapter.test.emedo.ch:7003 -cert mtls_caraikit_int.cer -key mtls_caraikit_int.key\n\nConnecting to 194.209.244.46\nCONNECTED(00000005)\n... \n\n---\nSSL handshake has read 7909 bytes and written 2704 bytes\nVerification: OK\n---\nNew, TLSv1.3, Cipher is TLS_AES_128_GCM_SHA256\nProtocol: TLSv1.3\nServer public key is 4096 bit\nThis TLS version forbids renegotiation.\nCompression: NONE\nExpansion: NONE\nNo ALPN negotiated\nEarly data was not sent\nVerify return code: 0 (ok)\n---\n</code></pre></p> <p>If the command returns, and/or the last output line is \"closed\", then the connection failed. In case of error, you can increase the log levels with the parameters <code>-state -debug -msg -prexit</code>.</p>"},{"location":"#webservice-connection","title":"Webservice connection","text":"<p>You can test the webservices connection with <code>curl</code>: <pre><code>curl -v --cert cert.pem --key private_key.key  \\\n  -H \"Content-Type: application/soap+xml;charset=UTF-8\" \\\n  -d '' \\\n  https://adapter.test.emedo.ch/\n</code></pre></p> <p>In case of success, you will see the content of the \"HTTP 404 - Not Found\" page of EMEDO. In case of error, you may see an error like \"curl: (56) OpenSSL SSL_read: error:14094410:SSL  routines:ssl3_read_bytes:sslv3 alert handshake failure, errno 0\".</p>"},{"location":"changelog/","title":"CARA INT Changelog","text":""},{"location":"changelog/#migration-to-emedo-platform","title":"migration to emedo platform","text":"<p>to migrate to the emedo platform from the existing integration platform the following new points have to be taken into considerations:</p> <ol> <li>Two new test patients are available for validation link</li> <li>use new client certificates and adapt endpoints config</li> <li>configure your new patient assigning authority source oid with CARA</li> <li>configure your IdP (e.g. HIN SAML NameID) with CARA for document access</li> </ol> <p>You can download the IKIT.postman_collection.json for example requests.</p> <p>Please note a few different platform behaviours:</p>"},{"location":"changelog/#pdq-v3-iti-47","title":"PDQ V3 ITI-47","text":"<p>If more than 5 results are available, the result with a success message will contain the first five results  and  indicate with a reasonOf/detectedIssueEvent entry that more specific search criteria should be specified. The existing platform had an en error message with acceptAckCode code set to NE. example</p>"},{"location":"changelog/#sts-xua-token-response-for-xds-calls","title":"STS XUA token response for XDS calls","text":"<p>The namespace declarations for xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' and xmlns:s='http://www.w3.org/2001/XMLSchema' are in the outer xml block in the response, meaning that if you extract the saml:Assertion by text it will be invalid xml without the above namespaces declared (this might not be the case if you reuse it directly). Verify for follow up requests that you have xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:s='http://www.w3.org/2001/XMLSchema' declared before. example. </p> <p>In addition the display names for the coded claims have to be provided, otherwise a follow up usage of the token can fail (open issue EPR-1404: SAML token validation failure: saml2:Assertion/saml2:AttributeStatement/saml2:Attribute[@Name='urn:oasis:names:tc:xspa:1.0:subject:purposeofuse']/saml2:AttributeValue/PurposeOfUse@displayName attribute required)</p>"},{"location":"changelog/#xds","title":"XDS","text":"<p>Ensure that start-info is in the http content-type header: (e.g. content-type: multipart/related; boundary=uuid:71766996-d9d7-484d-868d-8658c0c85d9a;type=\"application/xop+xml\";start-info=\"application/soap+xml; charset=utf-8\"), example request example</p>"},{"location":"changelog/#hpd-queries","title":"HPD queries","text":"<p>HPD queries need to have scope=\"wholeSubtree\", singleLevel does not work.</p>"},{"location":"changelog/#xds-iti-1843-requests-to-initiating-gateway-sufficient-no-document-registry-repository-calls-necessary","title":"XDS: ITI-18/43 Requests to Initiating Gateway sufficient (no Document Registry / Repository calls necessary)","text":"<p>An ITI-18 Query to the Initiating Gateway will return all document entries in all communities including document entries in the community of the Initiating Gateway. This means a separate request to the ITI-18 registry is not necessary, or otherwise duplicates would need to be filtered out. Equivalent an ITI-43 retrieve to the Initiating Gateway can handle also document retrieve within the own community, not only for the external communities. </p>"},{"location":"changelog_ikit/","title":"IKIT Changelog","text":""},{"location":"changelog_ikit/#version-2011-22012026","title":"Version 2.0.11 - 22/01/2026","text":"<ul> <li>Fix the XML Schema of the SubmitDocuments transaction (#162).</li> </ul>"},{"location":"changelog_ikit/#version-2010-21012026","title":"Version 2.0.10 - 21/01/2026","text":"<ul> <li>Add validation of <code>DocumentEntry.title</code> in ITI-41 (#161).</li> <li>Improve validation of GetDocumentList, DeleteDocumentList and SubmitDocuments transactions.</li> </ul>"},{"location":"changelog_ikit/#version-209-16122025","title":"Version 2.0.9 - 16/12/2025","text":"<ul> <li>Fix validation of Content-Type headers in multipart SOAP messages (#158).</li> <li>Update ATNA validators of Gazelle (#157).</li> <li>Hide 'external validation not run' message when there's no external validator (#156).</li> </ul>"},{"location":"changelog_ikit/#version-208-05122025","title":"Version 2.0.8 - 05/12/2025","text":"<ul> <li>Ignore more spammy requests on the syslog socket (#154).</li> </ul>"},{"location":"changelog_ikit/#version-207-28112025","title":"Version 2.0.7 - 28/11/2025","text":"<ul> <li>Fix extraction of HTTP headers in message validation.</li> <li>Various technical improvements.</li> </ul>"},{"location":"changelog_ikit/#version-206-03112025","title":"Version 2.0.6 - 03/11/2025","text":"<ul> <li>Fix loading of custom validators (#149).</li> <li>'External validation not run' message is now an info message instead of a warning (#147).</li> <li>Don't validate ActiveParticipants for 'Application activity' ATNA Audit Messages (#146).</li> <li>Fix analysis of SOAP 1.1 messages (#145).</li> <li>Improve handling of null bytes in syslog messages (#150).</li> <li>Display a proper error message when the SAML assertion doesn't contain the signing certificate in KeyInfo (#152).</li> <li>Fix improper validation error in ITI-41 request (#153).</li> </ul>"},{"location":"changelog_ikit/#version-205-24102025","title":"Version 2.0.5 - 24/10/2025","text":"<ul> <li>Various frontend design improvements.</li> <li>Enable XSD validation for ITI-41, ITI-43 and ITI-44 requests (#105).</li> <li>Upgraded to Java 25 LTS.</li> <li>Other dependency upgrades.</li> </ul>"},{"location":"changelog_ikit/#version-204-23102025","title":"Version 2.0.4 - 23/10/2025","text":"<ul> <li>Re-enable the ITI-44 and ITI-45 validators (#141).</li> <li>Using the AHVN13 instead of the EPR-SPID in ITI-44 is no longer a warning.</li> <li>Implement validation of AHVN13 and EPR-SPID values in ITI-44 (#140).</li> <li>Implement column resizing in the transaction list.</li> <li>Implement validation of Content-Type header in MTOM/XOP requests (#135).</li> <li>Implement XSD validation for ITI-18, ITI-45 and ITI-47 requests (#105).</li> </ul>"},{"location":"changelog_ikit/#version-203-09092025","title":"Version 2.0.3 - 09/09/2025","text":"<ul> <li>Fix the STS validator.</li> </ul>"},{"location":"changelog_ikit/#version-202-04092025","title":"Version 2.0.2 - 04/09/2025","text":"<ul> <li>Also match the CONNECT method when ignoring HTTP traffic on the syslog port (follow-up to #133).</li> <li>More robust multipart highlighting #136.</li> <li>Implement a custom STS validator for Emedo.</li> <li>Implement a SAML assertion validator.</li> </ul>"},{"location":"changelog_ikit/#version-201-25082025","title":"Version 2.0.1 - 25/08/2025","text":"<ul> <li>Ignore HTTP traffic sent on the syslog port #133.</li> <li>Handle null bytes in syslog messages.</li> <li>Fixed syslog proxying errors that were not displayed in the frontend.</li> <li>Many improvements of the syslog listener.</li> </ul>"},{"location":"changelog_ikit/#version-200-01082025","title":"Version 2.0.0 - 01/08/2025","text":"<ul> <li>Refactor of the IKIT to support multiple deployment (one per proxied service)</li> <li>IdP integration has been moved to its own project</li> <li>Implement support for the traceparent header</li> <li>Various improvements</li> </ul>"},{"location":"changelog_ikit/#version-1211-06092024","title":"Version 1.2.11 - 06/09/2024","text":"<ul> <li>Made the recipient list load faster.</li> <li>Improved the settings page.</li> <li>Clarified wordings in the transaction details page.</li> <li>Fixed the line numbering in the code editor, when a jump is performed.</li> <li>Improved the display of info messages in the code editor.</li> </ul>"},{"location":"changelog_ikit/#version-1210-13062024","title":"Version 1.2.10 - 13/06/2024","text":"<ul> <li>Fixed display of binary data when the multipart boundary is not found #107.</li> <li>Added a warning in the message validation when the external validation is disabled #108.</li> <li>Fixed various small issues in the frontend.</li> </ul>"},{"location":"changelog_ikit/#version-129-11062024","title":"Version 1.2.9 - 11/06/2024","text":"<ul> <li>Upgraded to Java 21 LTS.</li> <li>The content search now also searches in the message headers #99.</li> <li>Implemented the search by recipient #102.</li> <li>Handled error when parsing the boundary in multipart messages #100.</li> <li>Fixed a display issue in the transaction list for retina displays #106.</li> <li>Fixed validation of RegistryError.location #91.</li> <li>Implemented control of external validation by client, with automatic disabling after 8 hours #101.</li> </ul>"},{"location":"changelog_ikit/#version-128-08032024","title":"Version 1.2.8 - 08/03/2024","text":"<ul> <li>Added validation of ITI-45 PIXv3 queries.</li> <li>Downgraded the validation error when PIX Feeding with an AHV-number to a warning #86.</li> <li>Added a filter feature to search in requests and responses #39.</li> </ul>"},{"location":"changelog_ikit/#version-127-28022024","title":"Version 1.2.7 - 28/02/2024","text":"<ul> <li>Fixed connection with TrustID.</li> <li>Fixed an issue where the validation would not run anymore (again).</li> <li>Added milliseconds to the transaction details.</li> <li>Uniformized the validator names.</li> <li>Improved the exception messages when the Gazelle validator is not available.</li> <li>Fix overflow in validation results.</li> <li>Added simple validation of CH:XUA assertions.</li> </ul>"},{"location":"changelog_ikit/#version-126-15022024","title":"Version 1.2.6 - 15/02/2024","text":"<ul> <li>Fixed code not displayed in Safari.</li> <li>Hidden large binary blobs in the request and response.</li> <li>Fixed the code auto-format switching.</li> </ul>"},{"location":"changelog_ikit/#version-125-13022024","title":"Version 1.2.5 - 13/02/2024","text":"<ul> <li>Fixed display of binary data.</li> <li>Improved performance of the frontend (again).</li> <li>Added validation to authorInstitution in ITI-41 transactions.</li> </ul>"},{"location":"changelog_ikit/#version-124-22012024","title":"Version 1.2.4 - 22/01/2024","text":"<ul> <li>Improved performance of the frontend.</li> <li>Improved the transaction validation display.</li> <li>Updated the IDP icons.</li> <li>Fixed an issue where the validation would not be run anymore.</li> </ul>"},{"location":"changelog_ikit/#version-123-29112023","title":"Version 1.2.3 - 29/11/2023","text":"<ul> <li>Implemented line numbering in highlighted codes.</li> <li>Clients are now sorted by prefix in the list.</li> <li>Validators don't stop anymore at the first error.</li> <li>Added message for known issues with validators (IPF and EVSClient).</li> </ul>"},{"location":"changelog_ikit/#version-122-24112023","title":"Version 1.2.2 - 24/11/2023","text":"<ul> <li>Fixed message content processing, where binary data in multipart messages would be corrupted.</li> <li>Minor frontend improvements.</li> </ul>"},{"location":"changelog_ikit/#version-121-23112023","title":"Version 1.2.1 - 23/11/2023","text":"<ul> <li>Fixed error message in MTOM validation.</li> <li>Improved error messages in ATNA validation.</li> <li>Added pagination to results.</li> <li>Only showing runtime status if error, or request and response statuses in the transaction list.</li> <li>When clicking the status in the transaction list (e.g. \"response\" or \"runtime\"), the right tab will open.</li> <li>Increased effort to match audit messages to their client.</li> </ul>"},{"location":"changelog_ikit/#version-120-22112023","title":"Version 1.2.0 - 22/11/2023","text":"<ul> <li>A changelog is now published.</li> <li>Frontend redesign:<ul> <li>The code editor has been replaced with a simpler syntax highlighter, that should be lighter for the browser; the   native search function is not high-jacked anymore.</li> <li>The search API now returns fewer data, making the response smaller.</li> <li>There is now a minimal screen width needed for proper display.</li> </ul> </li> <li>The ITI-81 response validator is disabled because the CARA INT response still is at FHIR R3 version.</li> <li>The EVSClient validator of STS transactions has been fixed.</li> <li>The ITI-41 and ITI-43 requests are checked for valid MTOM use.</li> <li>The ITI-41 requests are checked for valid XOP use.</li> <li>The ATNA audit message validation has been improved.</li> <li>The client deletion has been fixed.</li> <li>The recipient is now filled on ATNA audit messages.</li> </ul>"},{"location":"faq/","title":"FAQ","text":""},{"location":"faq/#faq-integration-requests","title":"FAQ Integration Requests","text":""},{"location":"faq/#http-error-code-202-for-soap-request-eg-iti-18","title":"HTTP Error code 202 for SOAP Request (e.g. ITI-18)","text":"<p>check that in the SOAP WS:Header the <code>&lt;Address&gt;</code> element is in the same nampespace as the <code>&lt;ReplyTo&gt;</code> Element:</p> <pre><code>&lt;a:ReplyTo s:mustUnderstand=\"true\" xmlns:a=\"http://www.w3.org/2005/08/addressing\"&gt;\n    &lt;a:Address&gt;http://www.w3.org/2005/08/addressing/anonymous&lt;/a:Address&gt;\n&lt;/a:ReplyTo&gt;\n</code></pre>"},{"location":"faq/#content-type-returned-not-multipartrelated-but-applicationxml","title":"Content-Type returned not multipart/related but application/xml","text":"<p>ITI-TF says that one should use multipart/related, see ITI-43 \u00a73.43.5.1.1.1, verify that you have <code>start-info=\"application/soap+xml; charset=utf-8\"</code> (or no <code>start-info</code>).</p> <p>e.g:</p> <pre><code>Content-Type: multipart/related; boundary=\"uuid:f42c35e4-54b2-45ca-8fda-ed58b11f6fce\";type=\"application/xop+xml\"; start=\" &lt;root.message@cxf.apache.org&gt;\";start-info=\"application/soap+xml; charset=utf-8\"\n</code></pre> <p>Please check also that the <code>&lt;xop:Include&gt;</code> has no whitespace/linebreaks before or after the tag source, with linebreaks you get an HTTP 500 error (currently the EPR Integration kit shows it all the time wrapped, verify it with download request).</p>"},{"location":"faq/#sts-error","title":"STS error","text":"<p>Problem generating STS see request:</p> <pre><code>&lt;![CDATA[ERROR &lt;Ens&gt;ErrBPTerminated: Terminating BP BINT.AD.XUA.Process.AssertionProviderProcess # due to error: ERROR #5002: ObjectScript error: &lt;SUBSCRIPT&gt;GetGroupsForHCP+20^BINT.AD.XUA.WebServices.1 *tGroupsArr() Subscript 1 is \"\" &gt; ERROR #5002: ObjectScript error: &lt;SUBSCRIPT&gt;GetGroupsForHCP+20^BINT.AD.XUA.WebServices.1 *tGroupsArr() Subscript 1 is \"\"]]&gt;\n</code></pre> <p>Check that the HPD organization has the hcIdentifier capitalized as the following:</p> <pre><code>         &lt;attr xsi:type=\"s01:DsmlAttr\" name=\"hcIdentifier\"&gt;\n            &lt;value xsi:type=\"s01:DsmlValue\"&gt;RefData:OID:1.9.1:ACTIVE&lt;/value&gt;\n          &lt;/attr&gt;\n</code></pre> <p>(before it was refdata:oid:1.9.1:active)</p>"},{"location":"faq/#sts-error-500-with-tcu","title":"STS error 500 with TCU","text":"<p>if some STS TCU requests work and some not, check that you are in sync with the NTP time server, even below second differences can provoke that the assertion could be in the future for the STS (notBefore element, see issue)</p> <p>check also that you have no xml comments in request</p>"},{"location":"faq/#iti-41-http-error-code-500-soapbody-no-line-breaks-in-requests","title":"ITI-41: HTTP Error code 500 (soap:body no line breaks in requests)","text":"<p>2024-04-25: if the soap body is formatted with line breaks in the request, the request will not go through the back end (warning: empty request) and an http error 500 is returned, see xop:include comment above</p>"},{"location":"faq/#iti-45-no-mpi-pid-in-iti-45-response-if-queried-with-ahvn13","title":"ITI-45: No MPI-PID in ITI-45 response if queried with AHVN13","text":"<p>This is a data problem. Multiple local patients were either automatically or manually merged into the same master patient.</p>"},{"location":"faq/#iti-45iti-47-no-patient-data-returned","title":"ITI-45/ITI-47: No Patient data returned","text":"<p>Verify that the receiver id in the hl7 v3 message contains the oid for the integration system ( 2.16.756.5.30.1.177.2.2.1.1.3). You can also try to change the receiver OID to a random OID; if the patient data is returned, then someone fed a bad identifier to the patient and CARA needs to clean it manually.</p>"},{"location":"faq/#idp-hin-id","title":"IdP HIN ID","text":"<ol> <li>you need to have a GLN assigned to the HIN user that, otherwise the STS [ITI-40] will not work since the NameID is    not known -&gt; GLN not supported yet by emedo, you will receive an error message with:</li> </ol> <p>Terminating BP BINT.AD.XUA.Process.AssertionProviderProcess # due to error: ERROR #5001: Failed to load user:HIN_8a48175e776d770c414b37f1236b4a03553f6da1a94ccb7d990fe3c1b75941c1</p> <ol> <li>the test HIN ID expires after six months</li> </ol>"},{"location":"faq/#idp-trust-id","title":"IdP TRUST ID","text":"<ol> <li>if you authenticate with trust ID and eprik you have to provide the SAML2 NameID to be configured</li> <li>you can get test trust id here and manage    it here</li> </ol>"},{"location":"faq/#verify-if-tcu-certificate-is-correctly-installed","title":"Verify if TCU certificate is correctly installed","text":"<p>for the STS request the public certificate is added in the <code>&lt;ds:X509Certificate&gt;</code> in the <code>&lt;saml2:Assertion&gt;</code>. You can get the fingerprint of it copying the content of the <code>&lt;ds:X509Certificate&gt;</code> into the echo '' part:</p> <pre><code>echo 'MII... =' | base64 -d | openssl x509 -noout -text -fingerprint -sha1\n</code></pre> <p>The resulting sha1 Fingerprint=73:85:78:C8:C8:0C:DE:5D:7A:3E:06:38:6B:80:6E:65:47:FB:61:18 can be checked in the cara admin portal if the certificate is available there. For the STS request it is important that the oid attributed to the user/certificate (showing in parentheses) in also added in the STS request in the <code>&lt;saml2:NameID&gt;</code>.</p>"},{"location":"ikit-config/","title":"IKIT Configuration","text":"<p>The Integration Kit is available at https://ikit.cara.ch/dep.</p> <p> </p> Transaction List <p>By default it lists all transactions made during the day. You can filter by IHE transaction type or time range.</p>"},{"location":"ikit-config/#epr-endpoints","title":"EPR Endpoints","text":"<p>That the requests are routed through IKIT the following endpoints need to be configured in your primary system for IKIT instead of CARA INT for an EPR integration:</p> Transaction IKIT Host https://ikit.cara.ch Port 443 (https) or 80 (http) XDS [ITI-18] /dep/proxy/cara/Registry/services/RegistryService XDS [ITI-18] Initiating Gateway /dep/proxy/cara/XCA/services/InitiatingGatewayService XDS [ITI-41] /dep/proxy/cara/Repository/services/RepositoryService XDS [ITI-43] /dep/proxy/cara/Repository/services/RepositoryService XDS [ITI-43] Initiating Gateway /dep/proxy/cara/XCA/services/InitiatingGatewayService XDS MU [ITI-57] /dep/proxy/cara/Registry/services/RegistryService XDS RMU [ITI-92] /dep/proxy/cara/Registry/services/RegistryService XDS-I RAD [ITI-69] /dep/proxy/cara/Repository/services/RepositoryService PIX V3 [ITI-44] /dep/proxy/cara/UPIProxy/services/PIXPDQV3ManagerService PIX V3 [ITI-44] /dep/proxy/cara/UPIProxy/services/PIXV3ManagerService PIX V3 [ITI-45] /dep/proxy/cara/UPIProxy/services/PIXPDQV3ManagerService PIX V3 [ITI-45] /dep/proxy/cara/UPIProxy/services/PIXV3ManagerService PDQ V3 [ITI-47] /dep/proxy/cara/UPIProxy/services/PIXPDQV3ManagerService PDQ V3 [ITI-47] /dep/proxy/cara/UPIProxy/services/PDQV3ManagerService\u202f \u00a0 HPD [ITI-58] /dep/proxy/cara/HPD/services/HPDService HPD [ITI-59] /dep/proxy/cara/HPD/services/HPDService XUA [ITI-40] /dep/proxy/cara/STS/services/SecurityTokenService eCH-0213 (SEDEX Client / UPI Feed) /dep/proxy/cara/wsproxy/services/SpidManagementService eCH-0214 (SEDEX Client / UPI Query) /dep/proxy/cara/wsproxy/services/SpidQueryService2"},{"location":"ikit-config/#atna-iti-20","title":"ATNA [ITI-20]","text":"<p>atna.ikit.cara.ch:8080 or :80 (currently 83.228.202.234) unsecured TCP according to RFC5425 (no TLS supported) |</p> <p>For an IDP or TCU SAML2 assertion you can use https://ikit.cara.ch/idp/ (in progress).</p> <p>You find an overview of the current relevant specifications and the associated links for the Swiss Electronic Patient Record EPR also here.</p>"},{"location":"ikit-config/#external-validation","title":"External validation","text":"<p>The IKIT can use the Swiss EVS Client validator to validate various transactions and resources (like XUA assertions  and ATNA messages). Due to limited resources and rate limiting, the external validation is disabled by default. You  can enable it for a specific client in the Clients table. It will stay enabled for 8 hours and will be disabled  automatically.</p> <p>If the external validation is not enabled, a warning will be shown in the Validation part of the transaction details.</p>"},{"location":"pmp/","title":"CARA\u2019s eMedication service (PMP)","text":"<p>See CARA's eMedication IG.</p> <p>You can access any logs also directly at https://ws-pmp-int.cara.ch/pmp/mhd/logs.</p>"},{"location":"pmp/#eprik-integration-with-pmp","title":"eprik integration with pmp","text":"<ol> <li>Document query for a patient    via ITI-18 example</li> <li>MedicationList for a patient    via CH:PHARM1 example    and ITI-43 example</li> <li>Medication Card for a patient    via CH:PHARM1 example    and ITI-43 example</li> <li>Publication of a MTP document via    TCU ITI-41 example </li> </ol>"},{"location":"primarysystems-epr/","title":"EPR Primary System Integration","text":"<p>For a deep EPR integration into a primary systems the following usecases should be covered</p> <ol> <li>Integrate the strong authentication into the primary system with an IdP (Level 1)</li> <li>Search for patients in the community (Level 2.1)</li> <li>Register a patient from the primary system in the community (Level 2.1)</li> <li>Query and retrieve documents for a patient from the EPR including authorization (Level 2.2)</li> <li>Publish documents for a patient by a healthcare professional (Level 2.2)</li> <li>Providing AuditEvents (Level 2.1)</li> <li>Query and update the Healthcare Professional Directory (HPD) (Level 2.3)</li> <li>OID configuration</li> </ol> <p>The levels of integration are described by eHealth Suisse, see checklist [fr] and [de].</p> <p>eHealth Suisse has described the different steps with examples [fr], [de].</p> <p>You find test patients which you can use for publication of documents here.</p> <p>The healthcare professional portal can be found at https://professional.test.emedo.ch/login.</p> <p>Please find below additional information relevant for CARA and IKIT:</p>"},{"location":"primarysystems-epr/#1-integrate-the-strong-authentication-into-the-primary-system-with-and-idp","title":"1. Integrate the strong authentication into the primary system with and IdP","text":"<p>If you have a test user you can use the IdP Assertion from IKIT until you have done the IdP integration yourself. </p> <p>Note: The NameID has to be currently registered manually on the plattform, please contact us if you want to use strong authentication.</p>"},{"location":"primarysystems-epr/#2-search-for-patients-in-the-community","title":"2. Search for patients in the community","text":"<p>This sequence diagram shows the preferred way of managing patient identities. The first case, EPR set in PS is the case where you have already linked your local patient identity to an EPR  patient identity and fed your local identifier to the MPI. To get the MPI-PID and the EPR-SPID, you just have to query the MPI with your local identifier (described in section  3.2).</p> <p>The second case, EPR not set in PS, is the case where you have to reconciliate the patient identities. You can query the MPI for patient demographics (like name, birthdate, gender, etc., described in section 2.2) and  manually match demographics. Once that is done, you can feed your patient local identifier to the MPI (described in section 3.1).</p>"},{"location":"primarysystems-epr/#21-check-if-the-patient-has-an-epr-based-on-ahvn13navs","title":"2.1 Check if the patient has an EPR based on AHVN13/NAVS","text":"<p>With the PIX V3 query You can use AHVN13/NAVS13 to check if the patient has an EPR (EPR-SPID is returned), and if the patient is already registered in the community (MPI-PID is returned). See example request for patient Larissa Weinmann, which returns EPR-SPID and MPI-PID in the id elements. For a test patient who has no EPR (as of 7.7.2025) with AHVN13 7560739410295 no EPR-SPID and MPI-PID is returned, see request. If the the AHVN13 is not found, an Application Error (AE) will be returned. For a test patient who has an EPR but not in CARA int (as of 7.7.2025) with AHVN13 7560520619845 only EPR-SPID is returned, see request.</p>"},{"location":"primarysystems-epr/#22-demographics-query","title":"2.2 Demographics Query","text":"<p>A search for a patient is done via a demographics query. See detailed description here.</p> <p>IKIT example request, response. This example search is done on the family name, other demographics query parameters are possible. Please note that Swiss Extension requires that an error is returned if more than 5 matched are returned.</p> <p>You need to provide creationTime, sender OID and receiver OID in addition to the query parameters in the request. For the communication you need a client certificate but with IKIT a client certificate is not necessary.</p>"},{"location":"primarysystems-epr/#3-register-a-patient-from-the-primary-system-in-the-community-and-query-the-patient-community-id","title":"3. Register a patient from the primary system in the community and query the patient community id","text":""},{"location":"primarysystems-epr/#31-register-local-patient-id-in-the-community","title":"3.1 Register local patient Id in the community","text":"<p>Register a patient in a community. Primary systems need to use this transaction to register patient data and then to be able to provide and retrieve documents to the patients EPR. See detailed description here.</p> <p>IKIT example request, response. This example registers the local id from the primary system A001 of the patient identity domain 2.16.756.5.30.1.145 in the MPI. You need to provide creationTime, sender OID and receiver OID in addition to the patient parameters EPR-SPID, MPI-ID) in the request. For the communication you need a client certificate, but with IKIT a client certificate is not necessary.</p> <p>Danger</p> <p>Never feed a patient identifier with a domain that is not yours, and especially a domain equal to the configured receiver OID of the platform. It would make the patient unreachable from PDQ queries. The OID (patient assigning authority) needs to be configured first, otherwise it will give an error.</p>"},{"location":"primarysystems-epr/#32-query-mpi-pid-and-epr-spid-based-on-local-id","title":"3.2 Query MPI-PID and EPR-SPID based on local ID","text":"<p>The primary systems needs to query the master patient ID (MPI-ID) for patients to retrieve or provide documents for, based on the local id registered above. See detailed description here.</p> <p>IKIT example request, response.</p> <p>You see in the response that the patient has the MPI-PID 100001143 in 2.16.756.5.30.1.177.2.2.1.1 .</p>"},{"location":"primarysystems-epr/#4-query-and-retrieve-documents-for-a-patient-from-the-epr","title":"4. Query and retrieve documents for a patient from the EPR","text":"<p>This sequence diagram shows the search and retrieval of documents. Searching documents in emedo is described in section 4.2a, searching in other communities is described in section 4.2b. Retrieving a document is described in sections 4.3a and 4.3b, depending on the community. The PIXv3 query is shown as a reminder. For these calls, another mandatory step is the Get X-User Assertion call to get a XUA token from the EPR.</p>"},{"location":"primarysystems-epr/#41-authorization","title":"4.1 Authorization","text":"<p>To query and retrieve documents the HCP needs to be authorized based on the IdP or TCU token, the patient (resourceID with EPR-SPID), purposeOfUse (NORM, EMER) and role (HCP). See detailed description here.</p> <p>IKIT example request, response.</p> <p>Example STS requests with IdP.</p>"},{"location":"primarysystems-epr/#42a-query-documents-from-the-community","title":"4.2a Query documents from the community","text":"<p>Retrieve the document metadata for the documents stored in a patients EPR for the  community. See detailed description here.</p> <p>IKIT example request, response. For the Query the MPI-ID of the patient needs to be added. This example requests includes the security token necessary.</p> <p>With the IKIT you can do the user authentication there and reuse the token see. For the communication you need a client certificate but with IKIT a client certificate is not necessary.</p> <p>Note 1: You need to add two namespace prefix to your XDS request if you copy the assertion into your request (add xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:s=\"http://www.w3.org/2001/XMLSchema\" to wsse:Security).</p>"},{"location":"primarysystems-epr/#42b-query-documents-from-remote-communities","title":"4.2b Query documents from remote communities","text":"<p>To retrieve the document metadata for the documents stored in a patients EPR but registered in remote communities, the initiating gateway has to be called with an IIT-18 query. </p> <p>IKIT example request, response. Gassmann has also documents in the remote community (cara-ith) urn:oid:urn:oid:2.16.756.5.30.1.191.1.0</p> <p>See Note 1.</p>"},{"location":"primarysystems-epr/#43a-retrieve-documents-from-the-cara-community","title":"4.3a Retrieve documents from the CARA community","text":"<p>To retrieve documents from a patients EPR the IHE XDS.b profile and transactions needs to be used. See detailed description here.</p> <p>IKIT example request,response. With IKIT you can do the user authentication there and reuse the token see. For the communication you need a client certificate but with IKIT a client certificate is not necessary. You will need to add the HomeCommunityId, RepositoryUniqueId and DocumentUniqueId.</p> <p>Note 2: You need to add a start-info to the Content-Type header (e.g: Content-Type: multipart/related; boundary=uuid:f42c35e4-54b2-45ca-8fda-ed58b11f6fce;type=\"application/xop+xml\"; start-info=\"application/soap+xml; charset=utf-8\") as well as check Note 1.</p>"},{"location":"primarysystems-epr/#43b-retrieve-documents-from-remote-communities","title":"4.3b Retrieve documents from remote communities","text":"<p>To retrieve the documents stored in remote communities, the initiating gateway has to be called with an ITI-43 query with the homeCommunityId added from result 4.2b. IKIT example request, response.</p> <p>See Note 1 &amp; 2.</p>"},{"location":"primarysystems-epr/#5-publish-documents-for-a-patient-by-a-healthcare-professional","title":"5. Publish documents for a patient by a healthcare professional","text":"<p>This sequence diagram shows the publication of a document by a healthcare professional.</p> <p>To provide documents and metadata about the documents the IHE XDS.b profile and transactions needs to be used. See detailed description here.</p> <p>IKIT example request,response. With IKIT you can do the user authentication there and reuse the token see. For the communication you need a client certificate but with IKIT a client certificate is not necessary. You will need to add metadata for the document.</p>"},{"location":"primarysystems-epr/#confidentiality-code-in-metadata","title":"confidentiality code in metadata","text":"<p>The patient can set the default level of confidentiality to normally accessible , restricted accessible or secret. This need to be taken into account when publishing (sequence diagram). If a publication fails for normally accessible it has to be retried with restricted accessible. It is only possible to publish a document with confidentiality secret if the user has set the default confidentiality code to secret. To test this three different patients have been setup with different confidentiality codes: GASSMANN-IMHOLZ (normally accessible, EPR-SPID: 761337613645876216), SOARES JESUS (restricted accessible, EPR-SPID 761337616638768604) et Ratchawat (secret: EPR-SPID 761337610888245779)</p> Publication with normal restricted secret Gassmann (normally accessible) ok ok error SOARES JESUS (restricted accessible) error ok error Ratchawat (secret) error error ok"},{"location":"primarysystems-epr/#metadata-in-portal","title":"metadata in portal","text":"<p>TODO: </p> <p>The portal displays the metadata provided in the publication. The patient name is only visible if it is provided in PID-5 in sourcePatientInfo. example</p> <p>The institution can be filtered by the portal only if the <code>authorInstitution</code> contains an OID in the XON.10 field.</p>"},{"location":"primarysystems-epr/#provide-a-document-with-a-technical-user-tcu","title":"provide a document with a technical user (TCU)","text":"<p>This sequence diagram shows the publication of a document by a technical user.</p> <p>Instead of using an authenticated user for publishing documents, the ERP allows to publish documents with a technical user see factsheet in french. You are required to create a client certificate for this technical user and let it register in the HPD. See the developer platform for exact steps.</p> <p>IKIT allows you to work with a specific test technical user during integration. You can get the TCU IdP SAML2 assertion from here. This assertion is valid for 10 minutes. With this assertion you can get then the XUA (STS) token for the XDS requests, for the urn:e-health-suisse:principal-id you need to put the GLN to 2012345681729 when using IKIT's technical user EPR INT Emedo Frehner. example</p>"},{"location":"primarysystems-epr/#change-metadata-of-existing-documents-2223","title":"change metadata of existing documents (2.223)","text":"<p>TODO new platform: If a document has been added the metadata can be changed with the IHE Restricted Metadata Update Profile (RMU). See an example message here, where the document title is changed. A new ITI-18 query shows the changed title (Line 312). If you are working with a Technical User you would need to store the DocumentEntry including entryUUID during the provide and register transaction, because you cannot read it with ITI-18.</p>"},{"location":"primarysystems-epr/#replace-a-document","title":"Replace a document","text":"<p>To replace a document, the same ITI-41 transaction is used as for the publication of a new document, with the  addition of a specific <code>Association</code> element that shows which document is to be replaced:</p> <pre><code>&lt;rim:Association associationType=\"urn:ihe:iti:2007:AssociationType:RPLC\"\n                 sourceObject=\"urn:uuid:fa9b4f10-3ea1-436f-a988-ebbb8a2cfffc\"\n                 targetObject=\"urn:uuid:42fbb7ad-fe7a-4585-95c6-15d91a476c40\"\n                 id=\"(a unique id)\"/&gt;\n</code></pre> <p>TODO new platform: IKIT example request,response.</p>"},{"location":"primarysystems-epr/#using-entryuuids","title":"Using entryUUIDs","text":"<p>Warning</p> <p>The documents entryUUIDs may change at any time: if the metadata changes (through an ITI-92 transaction, or if  the patient changes the confidentiality level), or if the document is replaced, a new entryUUID will be generated.</p> <p>To change the metadata of a document, or to replace it with a new document, the entryUUID of the currently approved  DocumentEntry is required, and may be different from the submitted entryUUID in the original publication. In some  cases, it may prove impossible to retrieve the right entryUUID. In those cases, the help from CARA's administrators  can be requested, or the document may be republished as a new document.</p> <p>To retrieve the currently approved entryUUID of a document that has not been replaced, if a healthcare professional  is logged in, the ITI-18 search can be used with the document unique ID. If a technical user is logged in, there is  no possibility. Depending on the configured confidentiality levels, the document may not be returned in the search.</p> <p>To retrieve the currently approved entryUUID of a document that has been replaced, the ITI-18 GetRelatedDocuments  search can be used to retrieve the document that replaced the original document. A loop may be needed, if the  document has been replaced multiple times.</p>"},{"location":"primarysystems-epr/#6-providing-auditevents","title":"6. Providing AuditEvents","text":"<p>Each IHE Transaction has AuditEvent requirements. This is described for each transaction (see example for ITI-45 here or in eprik). This AuditEvents need to be registered in the community. With EVSClient you can validate if the content of the AuditMessages is correct. See for sending message via syslog protocol also guidance about not using BOM in IHE 3.20.4.1.2 Message Semantics.</p> <p>The specifications for generating the audit messages are given in the following documents:</p> <ol> <li>DICOM PS3.15 A.5: the    foundation of audit messages.</li> <li>IHE profile for each transaction: in the section 'Security    Considerations' of each transaction, you'll find IHE requirements.</li> <li>EPDV-EDI Annex 5 Complement 1: there are some Swiss    requirements too. \u00a71.5.2 describes generic requirements and \u00a71.6.4.3.5.1 describes requirements for transactions    that use a SAML assertion (XUA).</li> </ol> <p>EPD-by-example has some examples of audit messages.</p>"},{"location":"primarysystems-epr/#7-query-and-modify-the-healthcare-professional-directory-hpd","title":"7. Query and modify the Healthcare Professional Directory (HPD)","text":"<p>The HPD is an LDAP directory, and interactions with it are wrapped in DSMLv2 objects. It contains three different objects: professionals (ou=HCProfessional), organizations (ou=HCRegulatedOrganization) and relationship between them (ou=Relationship).</p>"},{"location":"primarysystems-epr/#71-query-entries","title":"7.1 Query entries","text":"<p>With the ITI-58 transaction, you can query the Healthcare Professional Directory (HPD) for the entries you are interested in. You can query entries with LDAP filters on LDAP attributes and select the attributes to return. Example, request.</p>"},{"location":"primarysystems-epr/#72-add-an-entry","title":"7.2 Add an entry","text":"<p>With the ITI-59 transaction, you can add an entry to the HPD with an addRequest. [Example]https://ikit.cara.ch/dep/#/transaction/e71b48eb-d65a-4e01-b221-26b5e7c476e2), request.</p>"},{"location":"primarysystems-epr/#73-modify-an-entry","title":"7.3 Modify an entry","text":"<p>With the ITI-59 transaction, you can update an entry in the HPD with a modifyRequest. Example, request.</p>"},{"location":"primarysystems-epr/#74-delete-an-entry","title":"7.4 Delete an entry","text":"<p>With the ITI-59 transaction, you can delete an entry from the HPD with a delRequest. Example, request.</p>"},{"location":"primarysystems-epr/#8-oid-configuration","title":"8. OID Configuration","text":"<p>TODO </p> Parameter Integration Production MPI OID Patient 2.16.756.5.30.1.177.2.2.1.1 2.16.756.5.30.1.177.2.2.2.1 HL7 v3 Receiver Device ID PIX V3 2.16.756.5.30.1.177.2.2.1.1.3 2.16.756.5.30.1.177.2.2.2.1.3\u00a0 HL7 v3 Receiver Device ID PDQ V3 2.16.756.5.30.1.177.2.2.1.1.7 2.16.756.5.30.1.177.2.2.2.1.7 Repository unique ID 2.16.756.5.30.1.177.2.2.1.1.2 2.16.756.5.30.1.177.2.2.2.1.2 Home Community ID. 2.16.756.5.30.1.177 2.16.756.5.30.1.177"},{"location":"testpatients/","title":"Testpatients","text":""},{"location":"testpatients/#test-patients","title":"Test Patients","text":"<p>The following test patients are setup for the integration systems to test publication as health professional. For retrieval you will need to ask the integration community that you get read access for the patients for your health professional.</p>"},{"location":"testpatients/#test-patients-with-cara-as-home-community-emedo","title":"Test patients with CARA as home community emedo","text":"FirstName LastName DateOfBirth Gender SSN EPR-SPID MPI_PID* Romain Th\u00e9ophile ZELLER-ROBERT-NICOUD 08.03.84 M 7560741992116 761337614242240684 100001177 Evelyne Muriel TESTA-MUSCIA 12.01.74 F 7560742155602 761337615140885281 100001181 Larissa B\u00e9n\u00e9dicte Albertine WEINMANN-HUGUENIN 30.05.13 F 7560625139705 761337612097656117 100001143 <p>761337615140885281</p>"},{"location":"testpatients/#test-patients-with-cara-previous-community","title":"Test patients with CARA previous community","text":"FirstName LastName DateOfBirth Gender SSN Comment Marion Jeanne Suzanne SOARES JESUS 25.05.1970 F 7560644233163 restricted default conf code CHRISTA LUZIA Ratchawat 11.10.1994 F 7560644214162 secret default conf code Kit Hung Elshani Aloci 27.09.2014 F 7560644765176 Dave Mathew Sarita Samuel 08.03.1984 M 7560644871280 Jannis Leonard FAVRE-JEANMONOD 11.02.2004 M 7560644892179 BRICE ROLAND LETTIERI-SERRA 16.01.1968 M 7560644981064 Cedric Maxime RAMOS ROGERIO 03.04.1978 M 7560644987394 WINIFRED Widmer-Zirm 04.03.2010 F 7560645085549 Jean-Philipp Michael Sutter-Rickenbacher 30.05.1991 M 7560645272765 STACY MARCIA AVDIJA-JASHARI 05.01.1971 F 7560645284416 Shukrullah MEIER-TUERK 15.02.1972 M 7560645346817 LOUIS DOMINIC ATAMBOTO LOMO 28.06.1985 M 7560645355383 CYRIL RENE FRANCOIS GASSMANN-IMHOLZ normal default conf code, currently broken, use another (as of 12.10.23)"},{"location":"testpatients/#test-patients-with-a-different-home-community","title":"Test patients with a different home community","text":"FirstName LastName DateOfBirth Gender SSN Comment MARCIA-APARECIDA STRASSER-BAER 15.09.1988 F 7560410146567 MDS Olivier Roger SHKODRA-VESELI 17.02.1976 M 7560410179848 MDS Oliver Artiom KUEHNI-TRAN 22.04.1974 M 7560410199921 MDS Anthony Th\u00e9ophile Walther Bl\u00f6chlinger-Ernst 18.01.2009 M 7560410212903 MDS MELINDA SOPHIE LUSTENBERGER-BAER 03.10.1985 F 7560615781303 SteHAG ALVIN CHRISTOPH Hoxha-Lamaxhema 17.02.1977 M 7560615860077 SteHAG"},{"location":"usecases/","title":"IKIT Usecases","text":"<p>The IKIT can help you speed up or test the development against the integration system:</p> <ol> <li>Use http(s) endpoints without the need to use client certificates</li> <li>Proxy functionality: See directly what you are sending to the integration system and receiving, including basic    validation, this is available for SOAP webservices and ATNA Audit Events</li> <li>Use the IdP Assertion from IKIT that you can get a XUA token from the STS (secure token service) to do document    queries or publish documents</li> <li>Use the TCU Assertion from IKIT that you can get a XUA token from the STS (secure token service) to publish a    document via a technical user</li> </ol>"},{"location":"usecases/#https-endpoints-without-the-need-to-use-client-certificates-and-proxy-functionality","title":"http(s) endpoints without the need to use client certificates and proxy functionality","text":"<p>Adapt your webservice endpoints to the one provided in [eprik-config.md]. This allows you to use http or https endpoints without the need to use client certificates from the beginning and you can verify the if the different webservices are working.</p> <p>To execute the examples you can either use curl or use the provided .http files if you have VSCode with the REST Client extension installed.</p> <p>Demographics Query for WEINMANN:</p> <pre><code>curl --request POST \\\n  --url https://ikit.cara.ch/dep/proxy/cara/int/UPIProxy/services/PIXPDQV3ManagerService \\\n  --header 'content-type: application/soap+xml;charset=UTF-8' \\\n  --header 'user-agent: vscode-restclient' \\\n  --data '&lt;soap:Envelope xmlns:soap=\"http://www.w3.org/2003/05/soap-envelope\"&gt;&lt;soap:Header&gt;&lt;Action soap:mustUnderstand=\"true\" xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;urn:hl7-org:v3:PRPA_IN201305UV02&lt;/Action&gt;&lt;MessageID xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;urn:uuid:88c76963-f467-49e2-a2c0-a772a4685ee3&lt;/MessageID&gt;&lt;To xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;https://ikit.cara.ch/dep/proxy/cara/int/UPIProxy/services/PIXPDQV3ManagerService&lt;/To&gt;&lt;ReplyTo xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;&lt;Address&gt;http://www.w3.org/2005/08/addressing/anonymous&lt;/Address&gt;&lt;/ReplyTo&gt;&lt;/soap:Header&gt;&lt;soap:Body&gt;&lt;PRPA_IN201305UV02 xmlns=\"urn:hl7-org:v3\" ITSVersion=\"XML_1.0\"&gt;&lt;id extension=\"1659464609650\" root=\"1.3.6.1.4.1.21367.2017.2.1.104\"/&gt;&lt;creationTime value=\"20220822083241\"/&gt;&lt;interactionId extension=\"PRPA_IN201305UV02\" root=\"2.16.840.1.113883.1.6\"/&gt;&lt;processingCode code=\"T\"/&gt;&lt;processingModeCode code=\"T\"/&gt;&lt;acceptAckCode code=\"AL\"/&gt;&lt;receiver typeCode=\"RCV\"&gt;&lt;device classCode=\"DEV\" determinerCode=\"INSTANCE\"&gt;&lt;id root=\"2.16.756.5.30.1.177.2.2.1.1.3\"/&gt;&lt;/device&gt;&lt;/receiver&gt;&lt;sender typeCode=\"SND\"&gt;&lt;device classCode=\"DEV\" determinerCode=\"INSTANCE\"&gt;&lt;id root=\"2.16.756.5.30.1.145.1.1\"/&gt;&lt;/device&gt;&lt;/sender&gt;&lt;controlActProcess classCode=\"CACT\" moodCode=\"EVN\"&gt;&lt;code code=\"PRPA_TE201305UV02\" displayName=\"2.16.840.1.113883.1.6\"/&gt;&lt;queryByParameter&gt;&lt;queryId extension=\"1659464609651\" root=\"1.3.6.1.4.1.21367.2017.2.1.104\"/&gt;&lt;statusCode code=\"new\"/&gt;&lt;responseModalityCode code=\"R\"/&gt;&lt;responsePriorityCode code=\"I\"/&gt;&lt;parameterList&gt;&lt;livingSubjectName&gt;&lt;value use=\"SRCH\"&gt;&lt;family&gt;WEINMANN&lt;/family&gt;&lt;/value&gt;&lt;semanticsText&gt;LivingSubject.name&lt;/semanticsText&gt;&lt;/livingSubjectName&gt;&lt;/parameterList&gt;&lt;/queryByParameter&gt;&lt;/controlActProcess&gt;&lt;/PRPA_IN201305UV02&gt;&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;'\n</code></pre>"},{"location":"usecases/#proxy-functionality","title":"Proxy functionality","text":"<p>You can then search for the request on ikit, it shows ALL requests/responses which happened today. You can also adjust the filter criteria. If you click on 'show' you see the details of the request:</p> <p></p> <p>If you click on 'Beautify code' it will pretty print the request / response (do not this for assertions which are signed when you wan't to reuse them). If you click on the 'Response' tab you get the response message. If an Assertion was provided you would see it in the 'Auth Assertion tab'. If the request failed internally you will see additional information in the 'Proxy Erro tab' tab. The status 'Response valid' is the IKIT internal validation of the request, it does not guarantee that the request is correct and accepted by the CARA integration system. You can activate Validation of the message for a 10 minutes timeslot in the Clients Settings tab. This uses the validators provided by ehealth suisse reference environment, see EVSClient</p>"},{"location":"usecases/#proxy-atna-messages","title":"proxy ATNA messages","text":"<p>IKIT offers an endpoint for unauthenticated transport receiver and sender according to rfc5425. The protocol requires that message length is sent first and then the other syslog parameters defined by ITI-20, see example.</p> <pre><code>2164 &lt;85&gt;1 2023-04-18T09:04:00.603Z matchbox.test - - IHE+RFC-3881 - &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;AuditMessage&gt; ...\n</code></pre> <p>TODO: with netcat the above message can be directly sent to ikit:</p> <pre><code>nc -w1 -v atna.ikit.cara.ch 8080 &lt; ./docs/requests/iti-47-atna-raw.txt \n</code></pre> <p>and is afterwards visible in eprik-cara atna example, see tab \"headers\" for detailed syslog protocol information.</p>"},{"location":"usecases/#use-the-idp-assertion-from-ikit","title":"Use the IdP Assertion from IKIT","text":"<p>For document access you need to have an assertion which is based on a IdP token.  IKIT allows you to get the IdP assertion which you can use for retrieving the SAML2 assertion token if your primary system is not integrated yet with the IdP.</p> <p>Authenticate with your Identity Provider. </p> <p>For web authenticated users you can get the IdP token through: https://test.ahdis.ch/eprik-cara/ and use Login: ... </p> <p>Note1: This is a temporary workaround until https://ikit.cara.ch/idp/ has integrated support for HIN and TrustID Note2: If you use https://test.ahdis.ch/eprik-cara with HinId or Trust Id the NameId would be to adapted in emedo currently</p> <p>If you are authenticated successfully you can add the IdP Token directly to your requests.</p> <p>Danger</p> <p>The IdP Token is  valid only for 5 minutes, and you will have to close / reopen the browser, otherwise you will get back the same token which is not valid anymore for the STS</p>"},{"location":"img/","title":"Index","text":"<p>The SVG images here can be loaded and modified in https://app.diagrams.net/.</p>"}]}